
> UDP 通信流程

    - UDP通信简介

        (1) BUDP 协议的通信较 TCP 简单了很多，减少了 TCP 的握手、确认、窗口、重传、拥塞控制等机制，UDP 是一个无状态的传输协议。

        (2) UDP 客户端在发送数据时并不判断主机是否可达，服务器是否开启等问题，同样它不能确定数据是否成功送达服务器。它只是将数据简单的封了一个包，之后就丢出去了。

![image](https://user-images.githubusercontent.com/42632290/135738694-d236f25d-1687-46de-9535-e7ed7dc2a3e0.png)

    - UDP特点及使用场景
   
	  （1）特点：
	  
             udp的数据是不安全的, 容易丢包
	     
			            § 丢包时候, 是丢全部还一部分?
				    
				              □ 丢全部
					      
              优点: 效率高
     
          （2）使用场景
     
     	    1. tcp使用场景
		         ○ 对数据安全性要求高的时候
			           § 登录数据的传输
			           § 文件传输
		         ○ http协议
			           § 传输层协议 - tcp
	        2. udp使用场景
		         ○ 效率高 - 实时性要求比较高
			           § 视频聊天
			           § 通话
		         ○ 有实力的大公司
			           § 使用upd，并在应用层自定义协议, 做数据校验，保证数据无差错传输
     
    - UDP通信分类
    
       根据不同的场景需要，我们可以将UDP编程设置为三种通信模式，分别如下：

            （1）单播
	    
            （2）广播
	    
	    （3）组播（也叫多播）
	    
       不同的通信模式是通过setsockopt系统接口来完成，默认是UDP是单播模式，组播和广播需要setsockopt来配合完成。

       以下是对三种通信方式概念说明

           单播，一对一的通信方式，一个客户端和一个服务端之间的消息通信
           广播，一对多的通信方式，一个主机对整个局域网上所有主机上的数据通信
           组播，一对多的通信方式，将网络上的主机进行逻辑上的分组，通信只会在同一个分组上面进行收发消息[单播和广播是两个极端，要么对一个主机进行通信，要么对整个局域网上的主机进行通信。实际情况下，经常需要对一组特定的主机进行通信，而不是整个局域网上的所有主机，这就是多播的用途] 
	   
        特点：
	
	单播的优点：
           1）服务器及时响应客户机的请求
           2）服务器针对每个客户不通的请求发送不通的数据，容易实现个性化服务。
        单播的缺点：
           1）服务器针对每个客户机发送数据流，服务器流量＝客户机数量×客户机流量；在客户数量大、每个客户机流量大的流媒体应用中服务器不堪重负。
           2）现有的网络带宽是金字塔结构，城际省际主干带宽仅仅相当于其所有用户带宽之和的5％。如果全部使用单播协议，将造成网络主干不堪重负
	
	广播的优点：
            1）网络设备简单，维护简单，布网成本低廉
            2）由于服务器不用向每个客户机单独发送数据，所以服务器流量负载极低。
        广播的缺点：
            1）无法针对每个客户的要求和时间及时提供个性化服务。
            2）广播禁止在Internet宽带网上传输

	组播的优点：
            1）需要相同数据流的客户端加入相同的组共享一条数据流，节省了服务器的负载。具备广播所具备的优点。
            2）由于组播协议是根据接受者的需要对数据流进行复制转发，所以服务端的服务总带宽不受客户接入端带宽的限制。IP协议允许有2亿6千多万个组播，所以其提供的服务可以非常丰富。
            3）此协议和单播协议一样允许在Internet宽带网上传输。
        组播的缺点：
            1）与单播协议相比没有纠错机制，发生丢包错包后难以弥补，但可以通过一定的容错机制和QOS加以弥补。
            2）现行网络虽然都支持组播的传输，但在客户认证、QOS等方面还需要完善，这些缺点在理论上都有成熟的解决方案，只是需要逐步推广应用到现存网络当中
    
    - UDP通信练习
   
      参考附件

> 广播

    - 广播通信概述
        
	TCP与UDP是单播通信，即单台主机与单台主机之间的数据通信。而广播是单台主机向网络中全部主机发送数据报的过程
	
![image](https://user-images.githubusercontent.com/42632290/135744520-970c97a5-a630-446c-a69c-11b13967cb55.png)
    
    - 广播使用场景及使用范围
    
         （1）使用场景
	 
	         像ARP地址解析协议和DHCP动态主机设置协议都会使用到UDP中的广播通信方式，这些客户端在启动时，会在第一时间以广播的形式向所在网络子网送报文
         
	 （2）使用范围

                 只适用于局域网
                 
       值得强调的是：本地广播信息是不会被路由器转发。当然这是十分容易理解的，因为如果路由器转发了广播信息，那么势必会引起网络瘫痪。这也是为什么IP协议的设计者故意没有定义互联网范围的广播机制。
    
    - 广播通信流程
    
       如果只想在本网络内广播数据，只要向广播地址发送数据包即可，这种数据包可以被路由，它会经由路由器到达本网段内的所有主机，此种广播也叫直接广播；如果想在整个网络中广播数据，要向255.255.255.255发送数据包，这种数据包不会被路由，它只能到达本物理网络中的所有主机，此种广播叫有限广播
       
       一般情况下，server只负责给client广播消息，不接收消息，因此Server的端口号可以随机获取
    
    	○ 服务器
	
		(1) 创建套接字 - socket
		(2) 配置广播的IP和端口
				□ struct sockaddr_in cli;
				□ cli.sin_family = af_inet;
				□ cli.port = htons(9898);
				□ inet_pton(af_inet, "xxx.xxx.123.255", &cli.adr);
		(4) 设置广播权限，使能广播
				□ setsockopt();

		(5) 发送广播数据
				□ sendto(fd, buf, len, 0, )

        ○ 客户端
	
		(1) 创建套接字
		(2) 绑定要接收广播的IP和端口
				□ bind();
		(3) 接收广播数据
				□ recvform();
    
     - 广播代码练习  
    
        见附件
    
> 组播

    - 组播通信概述

    多播也称为组播，组播是向指定的一组主机发送数据包。

    与单播相比，提高了发送数据包的效率。与广播相比。降低了网络流量。

![image](https://user-images.githubusercontent.com/42632290/136163025-b7fa461f-81bd-45ab-a9d8-821533c9ccde.png)

    “多播”可以理解为一个人向多个人（但不是在场的所有人）说话，这样能够提高通话的效率。如果你要通知特定的某些人同一件事情，但是又不想让其他人知道，使用电话一个一个地通知就非常麻烦，而使用日常生活的大喇叭进行广播通知，就达不到只通知个别人的目的了，此时使用“多播”来实现就会非常方便快捷，但是现实生活中多播设备非常少

    - 组播地址

    IP 组播通信必须依赖于 IP 多播地址，在 IPv4 中它是一个 D 类 IP 地址，范围从 224.0.0.0 到 239.255.255.255
    
    组播组可以是永久的也可以是临时的。组播组地址中，有一部分由官方分配的，称为永久组播组。永久组播组保持不变的是它的ip地址，组中的成员构成可以发生变化。永久组播组中成员的数量都可以是任意的，甚至可以为零。那些没有保留下来供永久组播组使用的ip组播地址，可以被临时组播组利用。
    
    224.0.0.0～224.0.0.255为预留的组播地址（永久组地址），地址224.0.0.0保留不做分配，其它地址供路由协议使用；
    
    224.0.1.0～224.0.1.255是公用组播地址，可以用于Internet；
    
    224.0.2.0～238.255.255.255为用户可用的组播地址（临时组地址），全网范围内有效；
    
    239.0.0.0～239.255.255.255为本地管理组播地址，仅在特定的本地范围内有效。
    
    - 组播通信流程
    
       一般情况下，server只负责给发消息， client只负责接收消息
    
    	○ 服务器
	
		(1) 创建套接字 - socket
		(2) 配置组播的IP和端口
				□ struct sockaddr_in cli;
				□ cli.sin_family = af_inet;
				□ cli.port = htons(9898);
				□ inet_pton(af_inet, "xxx.xxx.123.255", &cli.adr);
		(4) 使能组播权限并初始化
				□ setsockopt();

		(5) 发送组播数据
				□ sendto(fd, buf, len, 0, )

        ○ 客户端
	
		(1) 创建套接字
		(2) 绑定要接收组播的IP和端口
				□ bind();
		(3) 加入到组播地址
		                □ setsockopt();
		(3) 接收组播数据
				□ recvform();
    
    - 代码练习
    
        见附件

> 本地套接字



